version: '3.8'

services:
  # MySQL Database
  # mysql:
  #   image: mysql:8.0
  #   container_name: nelo-mysql
  #   restart: unless-stopped
  #   environment:
  #     MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
  #     MYSQL_DATABASE: ${MYSQL_DATABASE}
  #     MYSQL_USER: ${MYSQL_USER}
  #     MYSQL_PASSWORD: ${MYSQL_PASSWORD}
  #   ports:
  #     - "3306:3306"
  #   volumes:
  #     - mysql_data:/var/lib/mysql
  #     - ./database/schema.sql:/docker-entrypoint-initdb.d/schema.sql
  #   networks:
  #     - nelo-network
  #   healthcheck:
  #     test: [ "CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-padmin123" ]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5

  # Node.js Backend
  # node-backend:
  #   build:
  #     context: ./server
  #     dockerfile: Dockerfile
  #   container_name: nelo-node-backend
  #   restart: unless-stopped
  #   ports:
  #     - "3001:3001"
  #   environment:
  #     - PORT=3001
  #     - DATABASE_URL=${DATABASE_URL}
  #     - SUPABASE_URL=${VITE_SUPABASE_URL}
  #     - SUPABASE_ANON_KEY=${VITE_SUPABASE_ANON_KEY}
  #   networks:
  #     - nelo-network
  #   depends_on:
  #     - mysql

  # PHP Backend

  php-backend:
    build:
      context: .
      dockerfile: Dockerfile.php
    container_name: nelo-php-backend
    restart: unless-stopped
    # depends_on:
    #   mysql:
    #     condition: service_healthy
    environment:
      DB_CONNECTION: pgsql
      DB_HOST: db.nzyuwfxghaujzzfjewze.supabase.co
      DB_PORT: 5432
      DB_NAME: postgres
      DB_USER: postgres
      DB_PASS: ${DATABASE_PASSWORD:-StrongPass_Nelo_2026!}
      # Payment
      FLW_PUBLIC_KEY: ${FLW_PUBLIC_KEY}
      FLW_SECRET_HASH: ${FLW_SECRET_HASH}
      # SMTP
      SMTP_HOST: ${SMTP_HOST}
      SMTP_PORT: ${SMTP_PORT}
      SMTP_USER: ${SMTP_USER}
      SMTP_PASS: ${SMTP_PASS}
      SMTP_FROM_EMAIL: ${SMTP_FROM_EMAIL}
      SMTP_FROM_NAME: ${SMTP_FROM_NAME}
    networks:
      - nelo-network
    volumes:
      - ./api:/var/www/html
    ports:
      - "8000:80"

  # React Frontend
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: nelo-frontend
    restart: unless-stopped
    depends_on:
      - php-backend
    environment:
      VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
      VITE_SUPABASE_ANON_KEY: ${VITE_SUPABASE_ANON_KEY}
      VITE_API_URL: http://php-backend
    ports:
      - "3000:80"
      - "443:443"
    volumes:
      - ./certs:/etc/nginx/certs
    networks:
      - nelo-network
  # phpMyAdmin (optional - for database management)
  # phpmyadmin:
  #   image: phpmyadmin:latest
  #   container_name: nelo-phpmyadmin
  #   restart: unless-stopped
  #   depends_on:
  #     - mysql
  #   environment:
  #     PMA_HOST: mysql
  #     PMA_PORT: 3306
  #     PMA_USER: ${MYSQL_USER}
  #     PMA_PASSWORD: ${MYSQL_PASSWORD}
  #   ports:
  #     - "8080:80"
  #   networks:
  #     - nelo-network

networks:
  nelo-network:
    driver: bridge

volumes:
  mysql_data:
    driver: local
